## hoj-code-sandbox 在线判题系统代码沙箱
本项目作为HOJ在线判题系统的代码沙箱模块，可作为独立服务供外部使用。


## 项目亮点

### 1. 多语言扩展与设计模式优化
- **多语言扩展**：支持自定义语言扩展，目前已实现 **C++** 和 **Java**，方便后续扩展更多编程语言。
- **设计模式优化**：采用 **模板方法模式**、**策略模式**、**工厂模式** 等多种设计模式，提升代码的灵活性和可维护性。

### 2. 多种代码沙箱与安全执行环境
- **多种沙箱实现**：提供 **原生代码沙箱** 与 **Docker容器沙箱** 两种执行环境，利用 **Docker Java API** 进行容器管理，实现安全隔离。
- **进程超时控制**：通过 **守护线程** 和 **Thread等待机制** 实现进程超时中断，防止长时间阻塞或无限循环。
- **安全执行**：使用 **Java安全管理器** 限制用户代码权限，并结合 **黑名单** 与 **字典树** 筛查敏感操作，保障系统安全。
- **资源限制与容器安全**：利用 **HostConfig** 配置内存和 CPU 限制，同时启用 **只读文件系统** 和 **seccomp 策略**（JSON 配置），确保容器在受控安全的环境中运行.
- **动态执行与监控**：支持动态创建和启动容器，按需分配计算资源；实时监控容器资源使用情况，收集执行结果和错误信息，便于及时调优和故障排查。

### 3. 高效 Socket 连接与进程管理
- **Socket 连接池**：采用 **BlockingQueue** 维护 Socket 连接池，减少频繁创建连接的开销，提高执行效率。
- **心跳检测**：在借用连接前进行心跳检测，确保 Socket 有效，避免因无效连接影响代码执行。
- **进程健康检查**：定时检测 C++ 沙箱进程状态（每分钟检查一次），异常退出时自动重启，保证服务持续稳定。
- **进程监听机制**：支持在沙箱进程启动后自动初始化 Socket 连接池，确保依赖及时就绪。

### 4. 资源管理、日志与异常处理
- **自动资源清理**：在系统关闭时，通过 `@PreDestroy` 方法自动清理 Socket 连接池、停止健康检查线程，并安全关闭 C++ 沙箱进程，防止资源泄露。
- **日志记录**：完整的日志管理涵盖 Socket 交互、进程状态及异常情况，便于问题排查与调试。
- **统一异常处理**：统一捕获并处理异常，确保即使出现错误，系统仍能稳定运行。

### 5. 高级 C++ 沙箱实现与隔离技术
- **资源与权限隔离**：利用 **cgroup** 实现内存和 CPU 限制，确保执行过程在资源受控的环境中运行。
- **命名空间隔离**：通过 **clone()** 创建新的进程，并结合 **mount、PID、网络命名空间** 等隔离技术，实现父子进程的完全隔离，增强执行安全性。
- **挂载目录隔离**：采用挂载目录技术，将用户代码和运行时环境隔离，确保文件系统的安全和数据隐私。
- **异步多客户端支持**：使用 **epoll** 机制和多线程处理，实现对多个客户端请求的高并发、异步处理。
- **详细日志与错误处理**：通过 JSON 格式传输执行结果和错误信息，结合信号和退出状态的精细处理，便于快速定位和修复问题。